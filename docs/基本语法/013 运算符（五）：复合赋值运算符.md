# 运算符（五）：复合赋值运算符

**复合赋值运算符**（Compound Operator）是一种简化运算符调用过程的新型运算符。它不需要你单独学习新的语法，只要你掌握了原始的运算符规则，复合赋值运算符就相当于是一并掌握了。

复合赋值运算符针对于需要两个数值才能操作的运算符才有。比如说 `+`、`-`、`%`、`>>` 等等。这些运算符都可以使用复合赋值运算符来简化调用：`a op a = b` 可以简化成 `a op= b`。其中的 `op` 是一个运算符号。

## Part 1 经典的 a = a + 1 问题

入门初学赋值语句的时候，经常会看不懂 `a = a + 1` 类似的赋值过程。等号左侧的变量表示赋值方，右侧是表达式，是一个结果。等号的左右两侧虽然都有 `a`，但是实际上右侧的 `a` 只起到了取值的作用，而左侧的 `a` 起到的则是一个代号，表示赋值结果要到 `a` 变量里来，而不是赋值给别的变量上去。

正是因为如此，所有左右两侧可以完全使用同一个变量来赋值。`a = a + 1` 实际上就是把 `a` 原始的结果增大一个单位之后，将结果重新赋值给 `a` 的过程。这样理解的话，显然在语法语义上、逻辑上都是完全说得通的，也不产生错误。

## Part 2 复合赋值运算符的简化过程

实际上，前文给的 `a = a + 1` 可以使用复合赋值运算符来简化使用：`a += 1`。复合赋值运算符的类似模式还有很多，比如说 `a = a >> 3` 可以改写成 `a >>= 3`、`a = a * 5` 可以改写成 `a *= 5`、`a = a % (b * 7)` 可以改成 `a %= b * 7` 等等。

所以说，语法上基本上不用多说。稍微注意一下的是，只有如下的符号才有复合赋值运算符的配套写法。

* 数值加法运算、字符串拼接运算 `+`
* 减法运算 `-`
* 乘法运算 `*`
* 除法运算 `/`
* 取模运算 `%`
* 贪婪逻辑且运算、位与运算 `&`
* 贪婪逻辑或运算、位或运算 `|`
* 逻辑异或运算、位异或运算 `^`
* 位左移运算 `<<`
* 位右移运算 `>>`

就这么一些。基本上都有，对吧。不过，`&&` 和 `||` 就没有。比如说 `a = a && b` 就不能写成 ~~`a &&= b`~~，因为 C# 本身是没有这种复合赋值的。

## Part 3 怎么理解复合赋值运算

从人类的角度来说，复合赋值运算并不单单是一种简化写法。为了简化理解，我们没有必要从代码简化这个层面去绕一下。

思考一下，我们将数值本身增大（或者缩小），然后赋值回去，可以怎么理解呢？是的，累计。比如说 `a += 3` 就可以理解成“`a` 再增大 3 个单位”；`a *= 5` 表示“`a` 扩大 5 倍”。所以，它是一种累计的过程。这么理解就轻松一些了：从原有数据的基础上修改得到的新数值。

## Part 4 `a = a + 1`、`a += 1` 和 `a++` 有啥区别？

下面我们来说一下，`a = a + 1`、`a += 1` 和 `a++` 三者的区别。

实质上，三者没有语义上的区别（它们都是增大一个单位），如果 `a++` 直接写成语句的话（即 `a++;` 这样的，当然也可以包含 `++a;` 这样的东西，它俩之前说过是没区别的），那么 `a++`、`a = a + 1` 和 `a += 1` 三者都可以拿来比较。

不过说实在的，你完全可以认为，`a++` 是 `a += 1` 的简写，`a += 1` 又是 `a = a + 1` 的简写。而从性能分析上讲，它们依旧没有区别。但我们更建议使用具体化格式来代替广泛化格式。通用写法可以涵盖更多的格式，但它可能在处理过程之中和具体化的写法要复杂一点。当然，从书写上，简单的更香一些，不是吗？

## Part 5 串联赋值

赋值运算符和 `++`、`--` 运算符具有相同的功效。除了本身的行为以外，它自身（整个表达式）也是可以体现出一个数值的。举个例子：

```csharp
int a, b, c;
a = b = c = 3;
```

在第 2 行里，我们串联了多个赋值语句。按照赋值的方向（从右到左）来看，这个表达式等价于 `a = (b = (c = 3))`，即先将 `c = 3` 赋值完成后，将 `c` 的结果赋值给 `b`；最后，又把 `b` 的结果赋值给 `a`，以此达到串联赋值的效果。这里 `c = 3` 整个表达式的结果就是 3，即 `c` 赋值的结果。

这个用法还可以用于串联复合赋值运算。

```csharp
int a = 1, b = 2, c = 3, d;
d = a *= b += c;
```

表达式 `d = a *= b += c` 是一个串联赋值。按照赋值运算符的过程，这个表达式等价于 `d = (a *= (b += c))`。`b` 的原始数值是 2，那么 `b += c` 的结果就是将 `b` 改成 5（2 + 3）；然后，整个表达式 `b += c` 的结果就是 5，然后带入到 `a *= ...` 之中，即 `a *= 5`。而 `a` 此时是 1，因此 `a` 被改成 5。接着，`a *= ...` 整个表达式的结果也是 5，并最后赋值给 `d`，即执行的是 `d = ...` 整个语句。

所以，`d` 最后是 5 这个数值。

## Part 6 总结

本节我们学到了复合赋值运算符的赋值过程，而且重新回顾了赋值的过程。另外，复合赋值和普通赋值过程都带有一个结果，这个结果可以提供给别处使用。