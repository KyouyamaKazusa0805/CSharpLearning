# C# 新语法系列规划及完成情况

* [ ] 类型或成员声明语法扩展
  * [ ] 类型语法扩展
    * [ ] 综合类型
      * [x] C# 2 之泛型（067-072）
      * [x] C# 2 之分部类型（080）
      * [ ] 鸭子类型语法

    * [x] 类类型扩展
      * [x] C# 2 之静态类（081）

    * [x] 委托类型扩展
      * [x] C# 2 之匿名函数（073-075）
      * [x] C# 2 之方法组转委托（076）
      * [x] C# 2 之委托逆变参数和协变返回（077）
      * [x] C# 3 之 Lambda 表达式（094）
    * [x] 指针类型扩展
      * [x] C# 2 之定长缓冲区字段（087）
    
  * [x] 命名空间语法扩展
    * [x] C# 2 之类型和命名空间别名（078）
    * [x] C# 2 之外部别名（079）
  * [x] 属性语法扩展
    * [x] C# 2 之访问器上的访问修饰符（085）
    * [x] C# 3 之自动属性（092）
  
  * [x] 方法语法扩展
    * [x] C# 3 之分部方法（095）
    * [x] C# 3 之扩展方法（096）
* [x] 语句语法扩展
  * [x] C# 2 之迭代器语句（082-083）
  * [x] C# 2 之 `bool` 类型实例的 `switch` 语句用法（084）
  * [x] C# 2 之 `#pragma warning` 警告禁用指令（086）
  * [x] C# 3 之隐式变量类型声明（088）
* [ ] 表达式语法扩展
  * [x] 初始化器语法
    * [x] C# 3 之隐式数组变量类型的初始化器（089）
    * [x] C# 3 之对象初始化器（090）
    * [x] C# 3 之集合初始化器（091）
  * [ ] C# 3 之查询表达式（097-116）
    * [x] 106 C# 3 之查询表达式（十）：`from` 和 `select` 的底层原理
    * [x] 107 C# 3 之查询表达式（十一）：`let` 的底层原理
    * [x] 108 C# 3 之查询表达式（十二）：`where` 的底层原理
    * [ ] 109 C# 3 之查询表达式（十三）：`orderby` 的底层原理
    * [ ] 110 C# 3 之查询表达式（十四）：`group`-`by` 的底层原理
    * [ ] 111 C# 3 之查询表达式（十五）：`join`-`in`-`on`-`equals` 的底层原理
    * [ ] 112 C# 3 之查询表达式（十六）：LINQ 阶段性练习（二）
    * [ ] 113 C# 3 之查询表达式（十七）：聚合函数的自定义实现
    * [ ] 114 C# 3 之查询表达式（十八）：C# 语法分析原理简介
    * [ ] 115 C# 3 之查询表达式（十九）：表达式树和 `IQueryable<>` 接口
    * [ ] 116 C# 3 之查询表达式（二十）：LINQ 阶段性练习（三）
  * [x] 其它表达式
    * [x] C# 3 之匿名类型（093）
* [ ] 其它零碎语法



## C# 4 语法

| 语法名                 | 英文术语                                                  | 备注                              |
| ---------------------- | --------------------------------------------------------- | --------------------------------- |
| 动态绑定               | Dynamic Bindings                                          | `dynamic` 关键字和 `Dynamic` 类型 |
| 命名和可选参数         | Named & Optional Arguments                                |                                   |
| 泛型参数的协变和逆变性 | Co- & Contra- variance for Generic Delegates & Interfaces |                                   |

## C# 5 语法

| 语法名                           | 英文术语                                                   | 备注       |
| -------------------------------- | ---------------------------------------------------------- | ---------- |
| 异步方法                         | Asynchronous Methods                                       |            |
| 调用方信息特性                   | Caller Information Attributes                              |            |
| `foreach` 循环迭代变量的行为修改 | `foreach` loop was changed to generate a new loop variable | 破坏性修改 |

## C# 6 语法

| 语法名                                          | 英文术语                                         | 备注                |
| ----------------------------------------------- | ------------------------------------------------ | ------------------- |
| 静态引入类型                                    | Import of Static Type Members into Namespace     |                     |
| 异常筛选                                        | Exception Filters                                | `catch when` 从句   |
| 允许 `catch` 和 `finally` 块里使用 `await` 语句 | Await in `catch`/`finally` Blocks                |                     |
| 自动属性的初始化器                              | Auto Property Initializers                       |                     |
| 自动只读属性的初始化器                          | Default Values for Getter-only Properties        |                     |
| 表达式化的方法和只读属性声明                    | Expression-bodied Read-only Properties & Methods |                     |
| `null` 条件和 `null` 传播运算符                 | Null Propagator & Null-conditional Operator      | `??`、`?.` 和 `?[]` |
| 内插字符串                                      | String Interpolation                             |                     |
| `nameof` 表达式                                 | `nameof` Operator                                |                     |
| 字典初始化器                                    | Dictionary Initializer                           |                     |

## C# 7 语法

C# 7 版本的语法发布情况比较特殊，分为 C# 7.0、C# 7.1、C# 7.2 和 C# 7.3 四个小版本。一般我们不区分大版本和小版本，但因为 C# 7.0 情况的特殊性，我把特性全部按照小版本分组列出来。

| 版本 | 语法名                                     | 英文术语                                       | 备注   |
| ---- | ------------------------------------------ | ---------------------------------------------- | ------ |
| 7.0  | `out` 变量内联声明                         | `out` Variables                                |        |
|      | 模式匹配                                   | Pattern Matching                               |        |
|      | 值元组                                     | Value Tuples                                   |        |
|      | 解构                                       | Deconstruction                                 |        |
|      | 弃元                                       | Discards                                       |        |
|      | 本地函数                                   | Local Functions                                |        |
|      | 二进制字面量                               | Binary Literals                                |        |
|      | 数字分隔符                                 | Digit Separators                               |        |
|      | `ref` 返回值和临时变量                     | `ref` Returns & Locals                         |        |
|      | 广义化的异步返回类型                       | Generalized `async` Return Types               |        |
|      | 其余成员的表达式化声明                     | More Expression-bodied Members                 |        |
|      | `throw` 表达式                             | `throw` Expressions                            |        |
| 7.1  | `async` 主方法                             | `async` Main                                   |        |
|      | `default` 隐式类型表达式                   | `default` Expressions                          |        |
|      | 值元组元素名称推断                         | Inferred Tuple Element Names                   |        |
|      | 泛型可用的模式匹配                         | Pattern-matching with Generics                 | `T is` |
| 7.2  | `ref struct` 类型                          | `Span` and `ref`-like Types                    |        |
|      | `in` 参数和 `readonly` 引用                | `in` Parameters & `readonly` References        |        |
|      | `ref` 条件表达式                           | `ref` Conditional                              |        |
|      | 不必放在尾部的命名参数                     | Non-trailing Named Arguments                   |        |
|      | `private protected` 访问级别               | `private protected` Accessibility              |        |
|      | 允许字面量前缀后插入数字分隔符             | Digit Separators after Base Specifiers         |        |
| 7.3  | `Enum`、`Delegate` 和 `unmanaged` 泛型约束 | `Enum`, `Delegate` & `unmanaged` Constraints   |        |
|      | `ref` 临时变量的重新赋值                   | `ref` Locals Re-assignment                     |        |
|      | `stackalloc` 初始化器                      | `stackalloc` Initializers                      |        |
|      | 固定缓冲                                   | Indexing Movable `fixed` Buffers               |        |
|      | 自定义 `fixed` 语句固定对象                | Custom `fixed` Statement                       |        |
|      | 可用于初始化器和查询表达式里的表达式变量   | Expression Variables in Initializers & Queries |        |
|      | 值元组比较功能                             | Tuple Comparison                               |        |
|      | 底层字段的特性目标                         | Attributes on Backing Fields                   |        |

## C# 8 语法

| 语法名                         | 英文术语                                            | 备注                           |
| ------------------------------ | --------------------------------------------------- | ------------------------------ |
| 可空引用类型                   | Nullable Reference Types                            |                                |
| 默认接口成员                   | Default Interface Members                           |                                |
| 递归模式                       | Recursive Patterns                                  |                                |
| 异步流                         | `async` Streams                                     | `await foreach`、`await using` |
| `using` 变量声明增强           | Enhanced `using`                                    |                                |
| 索引和范围表达式               | Ranges & Indices                                    |                                |
| `null` 合并赋值                | `null`-coalescing Assignment                        | `??=`                          |
| 静态本地函数                   | `static` Local Functions                            |                                |
| 广义化非托管类型               | Unmanaged Generic `struct`s                         |                                |
| 只读成员                       | `readonly` Members                                  |                                |
| 任何时候的 `stackalloc` 表达式 | `stackalloc` in Nested Contexts                     |                                |
| 可调整的原义内插字符串         | Alternative Interpolated Verbatim Strings           | `$@""`、`@$""` 均可            |
| `[Obsolete]` 用于属性访问器    | Obsolete on Property Accessors                      |                                |
| 无约束泛型参数 `is null` 匹配  | Permit `t is null` on Unconstrainted Type Parameter |                                |

## C# 9 语法

| 语法名                       | 英文术语                                     | 备注                                 |
| ---------------------------- | -------------------------------------------- | ------------------------------------ |
| 记录类型                     | `record`s                                    |                                      |
| `with` 表达式                | `with` Expressions                           |                                      |
| 只初始化赋值器               | `init`-only Setters                          |                                      |
| 隐式主方法                   | Top-level Statements                         |                                      |
| 关系模式                     | Relational Patterns                          |                                      |
| 模式连词和括号模式           | Pattern Combinators & Parenthesized Patterns | `and`、`or` 和 `not`                 |
| 用于 `switch` 语句的类型模式 | Type Patterns on `switch` Statements         | `case T _` 改成 `case T`             |
| 底层变长整数类型             | Native-sized Integers                        | `nint` 和 `nuint`                    |
| 函数指针                     | Function Pointers                            |                                      |
| 禁止发出 `.localsinit` 指令  | Suppress Emitting `.localsinit` Flag         | `[SkipLocalsInit]` 特性的使用        |
| 隐式 `new` 表达式            | Target-typed `new` Expressions               |                                      |
| 静态匿名函数和 Lambda        | `static` Anonymous Functions & Lambdas       |                                      |
| 基于目标类型的条件表达式     | Target-typed Conditional Expressions         | 该特性包含对内置类型转换的破坏性修改 |
| 协变返回                     | Covariant Return Types                       |                                      |
| Lambda 参数弃元              | Lambda Discard Parameters                    |                                      |
| 适用于本地函数的特性         | Attributes on Local Functions                |                                      |
| 模块初始化器                 | Module Initializers                          | `[ModuleInitializer]` 特性的使用     |
| 扩展 `foreach` 循环          | Extension `GetEnumerator`                    |                                      |
| 分部方法增强                 | `partial` Methods with Returned Values       |                                      |
| 源代码生成器                 | Source Generators                            |                                      |
| 无约束的泛型参数可空性       | Unconstrainted Type Argument                 | `T?` 和 `default` 泛型约束           |

## C# 10 语法

| 语法名                                | 英文术语                            | 备注                                 |
| ------------------------------------- | ----------------------------------- | ------------------------------------ |
| 记录结构类型                          | `record struct`s                    |                                      |
| 基于任何结构的 `with` 表达式          | `with` Expressions on `struct`s     |                                      |
| 增强可空性表达式分析                  | Improved Definite Assignment        |                                      |
| 常量内插字符串                        | Constant Interpolated Strings       |                                      |
| 拓展属性模式                          | Extended Property Patterns          |                                      |
| `sealed record ToString`              | `sealed record ToString`            |                                      |
| 增量源代码生成器                      | Incremental Source Generators       | 增强源代码生成器，以用于高性能场景下 |
| 混合解构                              | Mixed Deconstructions               | 允许解构和变量定义混合在一起         |
| 用于方法级别的 `[AsyncMethodBuilder]` | Method-level `[AsyncMethodBuilder]` |                                      |
| `#line` 指令对列对齐的支持            | `#line` Span Directive              |                                      |
| Lambda 增强                           | Lambda Improvements                 |                                      |
| 自定义内插字符串处理器                | Interpolated String Handlers        |                                      |
| 基于文件范围的命名空间声明            | File-Scoped Namespaces              |                                      |
| 自定义结构的无参构造器                | Parameterless `struct` Constructors |                                      |
| 调用方参数表达式特性                  | `[CallerArgumentExpression]`        |                                      |

## C# 11 语法（动态更新）

| 语法名                    | 英文术语                                 | 备注                                           |
| ------------------------- | ---------------------------------------- | ---------------------------------------------- |
| 内插内换行                | Newlines in Interpolations               | 不再需要内插部分内换行原本必须加的 `@` 记号    |
| 列表模式                  | List Patterns                            | `[_, ..]`、`[1, 2, 3]` 之类的模式匹配规则      |
| 原始字符串字面量          | Raw String Literals                      | `"""` 以及更多双引号序列表示                   |
| 泛型特性                  | Generic Attributes                       |                                                |
| 静态抽象成员              | Static Abstract Members in Interfaces    |                                                |
| 结构数据成员自动初始化    | Auto-`default` Structures                |                                                |
| 半自动属性                | Semi-auto-implemented Properties         | `field` 关键字                                 |
| 要求初始化成员            | Required Members                         | `required` 关键字                              |
| `main` 特性目标           | `main` Attribute Target                  | 用于隐式 `Main` 方法的特性目标 `[main: ...]`   |
| `nameof` 范围拓展         | Extended Scope of `nameof`               | 允许方法参数以及方法类型参数参与 `nameof` 使用 |
| `ref` 字段                | Ref Fields                               | 允许 `ref struct` 定义引用字段                 |
| `checked` 运算符重载      | Checked Operators                        | 允许区分部分运算符的算术安全性                 |
| 无符号右移运算符          | Unsigned Right Shift                     | 和 Java 一样的 `>>>` 和 `>>>=` 运算符          |
| `ReadOnlySpan<char>` 匹配 | Pattern Matching on `ReadOnlySpan<char>` | 使用模式匹配 `ReadOnlySpan<char>` 字符序列     |
| UTF-8 字符串              | UTF-8 String Literals                    | `u8` 后缀定义 UTF8 编码的字符串                |
| 基于文件存储的类型        | File Types                               | `file` 关键字                                  |
| 将指针处理数字化          | Numeric `IntPtr`                         |                                                |